From 7b14824b86e2fb8d9e6e317bd3b4f314bb01f95d Mon Sep 17 00:00:00 2001
From: Jonathan Helmus <jjhelmus@gmail.com>
Date: Wed, 1 Aug 2018 15:13:37 -0500
Subject: [PATCH 2/4] lazy bind C extension

When run on a system without a GPU, PyTorch does not require the CUDA
libraries. Therefore symbols should not be resolved at load time rather
resolution should be defered until the function is called (lazy binding).
---
 setup.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/setup.py b/setup.py
index 2065462..74f2ed6 100644
--- a/setup.py
+++ b/setup.py
@@ -862,7 +862,7 @@ C = Extension("torch._C",
               extra_compile_args=main_compile_args + extra_compile_args,
               include_dirs=[],
               library_dirs=library_dirs,
-              extra_link_args=extra_link_args + main_link_args + [make_relative_rpath('lib')],
+              extra_link_args=extra_link_args + main_link_args + ['-Wl,-z,lazy'] + [make_relative_rpath('lib')],
               )
 extensions.append(C)
 
-- 
2.7.4

